<div *ngIf="step === 1">
  <nz-card nzTitle="Information de l'Expédition">
    <form nz-form [formGroup]="expeditionForm" (ngSubmit)="submitForm()">
      <!-- First Row -->
      <nz-row [nzGutter]="16">
        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <nz-select formControlName="type" nzPlaceHolder="Select a type">
                <nz-option *ngFor="let type of ExpeditionTypes" [nzValue]="type" [nzLabel]="type"></nz-option>
              </nz-select>
              <div *ngIf="expeditionForm.get('type')?.dirty && expeditionForm.get('type')?.errors" class="error">
                Please select a type
              </div>
            </nz-form-control>
          </nz-form-item>
        </nz-col>

        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <input nz-input formControlName="origin" placeholder="Enter origin">
              <div *ngIf="expeditionForm.get('origin')?.dirty && expeditionForm.get('origin')?.errors" class="error">
                Please enter the origin
              </div>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <!-- Second Row -->
      <nz-row [nzGutter]="16">
        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <input nz-input formControlName="destination" placeholder="Enter destination">
              <div *ngIf="expeditionForm.get('destination')?.dirty && expeditionForm.get('destination')?.errors" class="error">
                Please enter the destination
              </div>
            </nz-form-control>
          </nz-form-item>
        </nz-col>

        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <input nz-input formControlName="expedition_number" placeholder="Enter expedition number">
              <div *ngIf="expeditionForm.get('expedition_number')?.dirty && expeditionForm.get('expedition_number')?.errors" class="error">
                Please enter the expedition number
              </div>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <!-- Third Row -->
      <nz-row [nzGutter]="16">
        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <input nz-input formControlName="date_expedition" type="datetime-local" placeholder="Heure de départ"/>
              <div *ngIf="expeditionForm.get('date_expedition')?.dirty && expeditionForm.get('date_expedition')?.errors" class="error">
                Please select the date of expedition
              </div>
            </nz-form-control>
          </nz-form-item>
        </nz-col>

        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <input nz-input formControlName="date_livraison_prevue" type="datetime-local" placeholder="Heure d'arrivée"/>
              <div *ngIf="expeditionForm.get('date_livraison_prevue')?.dirty && expeditionForm.get('date_livraison_prevue')?.errors" class="error">
                Please select the expected delivery date
              </div>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <!-- Fourth Row -->
      <nz-row [nzGutter]="16">
        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <nz-select formControlName="vehicle_license" nzPlaceHolder="Select a vehicle license">
                <nz-option *ngFor="let license of VehicleLicenses" [nzValue]="license.license" [nzLabel]="license.license"></nz-option>
              </nz-select>
              <div *ngIf="expeditionForm.get('vehicle_license')?.dirty && expeditionForm.get('vehicle_license')?.errors" class="error">
                Please select a vehicle license
              </div>
            </nz-form-control>
          </nz-form-item>
        </nz-col>

        <nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-control>
              <textarea nz-input formControlName="notes" placeholder="Enter any notes"></textarea>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <!-- Submit Button -->
      <nz-row>
        <nz-col [nzSpan]="24" style="text-align: right;">
          <nz-form-item>
            <nz-form-control [nzSm]="14" [nzXs]="24" [nzOffset]="6">
              <button nz-button nzType="primary" [nzLoading]="loading" [disabled]="expeditionForm.invalid">
                <i nz-icon nzType="save"></i> Enregistrer
              </button>
              <button nz-button nzType="default" (click)="resetForm()" [disabled]="loading" style="margin-left: 8px;">Réinitialiser</button>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>
    </form>
  </nz-card>
</div>

<div *ngIf="step === 2">
  <div class="container-fluid py-4">
    <div class="row mb-4">
      <div class="col-md-6">
        <button nz-button nzType="default" (click)="toggleAllMerchandises()">
          {{ showAllMerchandises ? 'Cacher les marchandises pas convenables' : 'Afficher toutes les marchandises' }}
        </button>
      </div>
      <div class="col-md-6">
        <button nz-button nzType="primary" (click)="toggleSelectAll()">
          {{ selectAll ? 'Deselect All' : 'Select All' }}
        </button>
      </div>
    </div>
    <h3>Select Merchandise</h3>
    <div nz-row nzGutter="16">
      <div nz-col nzSpan="8" *ngFor="let merchandise of merchandises">
        <div class="card">
          <div class="card-header p-3 pt-2">
            <div class="text-end pt-1">
              <h4 class="mb-0">{{ merchandise.name }}</h4>
            </div>
          </div>
          <hr class="dark horizontal my-0">
          <div class="card-body">
            <p>{{ merchandise.description }}</p>
            <label nz-checkbox [(ngModel)]="merchandise.selected" (ngModelChange)="onMerchandiseSelect(merchandise)">Select</label>
          </div>
        </div>
      </div>
    </div>
    <div nz-row nzJustify="center" style="margin-top: 16px;">
      <button nz-button nzType="primary" (click)="submitSelectedMerchandises()">Submit Selected Merchandise</button>
    </div>
  </div>
</div>


<nz-alert *ngIf="submitError" nzType="error" [nzMessage]="submitErrorMessage" nzShowIcon></nz-alert>
<nz-alert *ngIf="submitSuccess" nzType="success" [nzMessage]="submitSuccessMessage" nzShowIcon></nz-alert>
